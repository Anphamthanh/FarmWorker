<div class="demographics-container show" style="margin-top:1rem;">
  <div class="container">
    <%= form_for(:patient_record, url: patient_update_record_path, type: "demographics", :validate => true, :class => 'form-horizontal') do |f| %>
      <div class="form-group row col-md-8">
        <div class="col-md-5">
          <%= f.label :site_location %>
        </div>
        <div class="col-md-7">
          <% site_location = @patient.site_location.empty? ? "Cox Elementary School" : @patient.site_location %>
          <%= f.text_field :site_location, :class => "form-control", :value => site_location %>  
        </div>
      </div>
      <div class="form-group row col-md-8">
        <div class="col-md-5">
          <%= f.label :allergies %>
        </div>
        <div class="col-md-7">
          <% allergies = @patient.allergies %>
          <textarea placeholder="Allergies" name="patient_record[allergies]" class="form-control" rows="2"><%= allergies %></textarea>
        </div>
      </div>
      <div class="form-group row col-md-8">
        <div class="col-md-5">
          <%= f.label :reaction_type %>
        </div>
        <div class="col-md-7">
          <% reaction_type = @patient.reaction_type %>
          <textarea placeholder="Reactions" name="patient_record[reaction_type]" class="form-control" rows="2"><%= reaction_type %></textarea>
        </div>
      </div>
      <div class="form-group row col-md-12">
        <hr>
        <label>Immunizations Received</label>
        <a href="<%= image_path 'cdc-schedule.png' %>" data-lightbox="imm-schedule">
          (View Recommended Schedule) <i class="fa fa-image fa-lg"></i>
        </a>
      </div>
      <div class="form-group row col-md-8">
        <div class="col-md-5">
          <%= f.label :utd, "Up To Date" %>
        </div>
        <div class="col-md-7">
          <input type="checkbox" name="patient_record[utd]" id="utd">
        </div>
      </div>
      <% if @patient.get_dtap_count > 0 %>
        <div class="form-group row col-md-8">
          <div class="col-md-5">
            <%= f.label :dtap, "DTaP" %>
          </div>
          <div class="col-md-7">
            <input type="checkbox" <%= @patient.dtap != 0 ? "" : "checked" %> name="patient_record[dtap]" value="0" /> None 
            <% (1..@patient.get_dtap_count).each do |order| %> 
              <input type="checkbox" <%= order <= @patient.dtap ? "checked" : "" %>
              name="patient_record[dtap]" class="imm" value="<%= order %>" />
              <strong><%= order.ordinalize() %></strong> Dose 
            <% end %>
          </div>
        </div>
      <% end %>
      <% if @patient.get_hepa_count > 0 %>
        <div class="form-group row col-md-8">
          <div class="col-md-5">
            <%= f.label :hepa, "HepA" %>
          </div>
          <div class="col-md-7">
            <input type="checkbox" <%= @patient.hepa != 0 ? "" : "checked" %> name="patient_record[hepa]" value="0" /> None 
            <% (1..@patient.get_hepa_count).each do |order| %> 
              <input type="checkbox" <%= order <= @patient.hepa ? "checked" : "" %>
              name="patient_record[hepa]" class="imm" value="<%= order %>" />
              <strong><%= order.ordinalize() %></strong> Dose 
            <% end %>
          </div>
        </div>
      <% end %>
      <% if @patient.get_hepb_count > 0 %>
        <div class="form-group row col-md-8">
          <div class="col-md-5">
            <%= f.label :hepb, "HepB" %>
          </div>
          <div class="col-md-7">
            <input type="checkbox" <%= @patient.hepb != 0 ? "" : "checked" %> name="patient_record[hepb]" value="0" /> None 
            <% (1..@patient.get_hepb_count).each do |order| %> 
              <input type="checkbox" <%= order <= @patient.hepb ? "checked" : "" %>
              name="patient_record[hepb]" class="imm" value="<%= order %>" />
              <strong><%= order.ordinalize() %></strong> Dose 
            <% end %>
          </div>
        </div>
      <% end %>
      <% if @patient.get_hib_count > 0 %>
        <div class="form-group row col-md-8">
          <div class="col-md-5">
            <%= f.label :hib, "HiB" %>
          </div>
          <div class="col-md-7">
            <input type="checkbox" <%= @patient.hib != 0 ? "" : "checked" %> name="patient_record[hib]" value="0" /> None 
            <% (1..@patient.get_hib_count).each do |order| %> 
              <input type="checkbox" <%= order <= @patient.hib ? "checked" : "" %>
              name="patient_record[hib]" class="imm" value="<%= order %>" />
              <strong><%= order.ordinalize() %></strong> Dose 
            <% end %>
          </div>
        </div>
      <% end %>
      <% if @patient.get_mmr_count > 0 %>
        <div class="form-group row col-md-8">
          <div class="col-md-5">
            <%= f.label :mmr, "MMR" %>
          </div>
          <div class="col-md-7">
            <input type="checkbox" <%= @patient.mmr != 0 ? "" : "checked" %> name="patient_record[mmr]" value="0" /> None 
            <% (1..@patient.get_mmr_count).each do |order| %> 
              <input type="checkbox" <%= order <= @patient.mmr ? "checked" : "" %>
              name="patient_record[mmr]" class="imm" value="<%= order %>" />
              <strong><%= order.ordinalize() %></strong> Dose 
            <% end %>
          </div>
        </div>
      <% end %>
      <% if @patient.get_men_count > 0 %>
        <div class="form-group row col-md-8">
          <div class="col-md-5">
            <%= f.label :men, "Men" %>
          </div>
          <div class="col-md-7">
            <input type="checkbox" <%= @patient.men != 0 ? "" : "checked" %> name="patient_record[men]" value="0" /> None 
            <% (1..@patient.get_men_count).each do |order| %> 
              <input type="checkbox" <%= order <= @patient.men ? "checked" : "" %>
              name="patient_record[men]" class="imm" value="<%= order %>" />
              <strong><%= order.ordinalize() %></strong> Dose 
            <% end %>
          </div>
        </div>
      <% end %>
      <% if @patient.get_pneumovax_count > 0 %>
        <div class="form-group row col-md-8">
          <div class="col-md-5">
            <%= f.label :pneumovax, "Pneumovax" %>
          </div>
          <div class="col-md-7">
            <input type="checkbox" <%= @patient.pneumovax != 0 ? "" : "checked" %> name="patient_record[pneumovax]" value="0" /> None 
            <% (1..@patient.get_pneumovax_count).each do |order| %> 
              <input type="checkbox" <%= order <= @patient.pneumovax ? "checked" : "" %>
              name="patient_record[pneumovax]" class="imm" value="<%= order %>" />
              <strong><%= order.ordinalize() %></strong> Dose 
            <% end %>
          </div>
        </div>
      <% end %>
      <% if @patient.get_influenza_count > 0 %>
        <div class="form-group row col-md-8">
          <div class="col-md-5">
            <%= f.label :influenza, "Influenza" %>
          </div>
          <div class="col-md-7">
            <input type="checkbox" <%= @patient.influenza != 0 ? "" : "checked" %> name="patient_record[influenza]" value="0" /> None 
            <% (1..@patient.get_influenza_count).each do |order| %> 
              <input type="checkbox" <%= order <= @patient.influenza ? "checked" : "" %>
              name="patient_record[influenza]" class="imm" value="<%= order %>" />
              <strong><%= order.ordinalize() %></strong> Dose 
            <% end %>
          </div>
        </div>
      <% end %>
      <div class="form-group row col-md-8">
        <div class="col-md-5">
          <%= f.label "Additional Immunizations" %>
        </div>
        <div class="col-md-7">
          <% additional_immunizations = @patient.additional_immunizations %>
          <textarea placeholder="Additional Immunizations" name="patient_record[additional_immunizations]" class="form-control" rows="2"><%= additional_immunizations %></textarea>
        </div>
      </div>
      <div class="form-group row col-md-8">
        <div class="col-md-5">
          <%= f.label "Additional Notes" %>
        </div>
        <div class="col-md-7">
          <% additional_notes = @patient.additional_notes %>
          <textarea placeholder="Additional Notes" name="patient_record[additional_notes]" class="form-control" rows="2"><%= additional_notes %></textarea>
        </div>
      </div>
      <div class="form-group row col-md-12">
        <hr>
        <div class="container col-md-8">
          <label class="col-md-5">Working Practitioner(s)</label>
          <div class="col-md-7">
            <% practitioner = @patient.practitioner.empty? ? "#{current_user.first_name} #{current_user.last_name}" : @patient.practitioner %>
            <%= f.text_field :practitioner, :class => "form-control", :value => practitioner %>
          </div>  
        </div>
      </div>
      <div class="form-group row col-md-12">
        <div class="col-md-12"> 
          <button type="submit" class="btn btn-success">Save &amp; Next</button>
          <button type="button" class="btn btn-danger pull-right exit">Exit</button>
        </div>
      </div>

    <% end %>
  </div>
</div>

<script>
  $(".demographics").addClass("active");
  $("#utd").change(function() {
    if ($(this).prop("checked")) {
      $(".imm").prop("checked", true);
    }
    else {      
      $(".imm").prop("checked", false);
    }
  });
</script>
